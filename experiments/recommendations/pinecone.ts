import * as dotenv from "dotenv";
import type { MatterArticle } from "../../sources/matter/types";
import type { ReadwiseArticle } from "../../sources/readwise-reader/types";

dotenv.config();

const PINECONE_API_TOKEN = process.env.PINECONE_API_TOKEN || "";
const ARTICLES_INDEX = process.env.ARTICLES_INDEX || "";

type Vector = {
	id: string;
	values: number[];
	metadata: ReadwiseArticle | MatterArticle;
};

type UpsertRequest = {
	vectors: Vector[];
};

export const upsertToPinecone = async (vectors: Vector[]) => {
	try {
		const url = `${ARTICLES_INDEX}/vectors/upsert`;
		const headers = {
			"Api-Key": PINECONE_API_TOKEN,
			"Content-Type": "application/json",
			"X-Pinecone-API-Version": "2024-07",
		};
		const body: UpsertRequest = {
			vectors,
		};

		const result = await fetch(url, {
			method: "POST",
			headers,
			body: JSON.stringify(body),
		});

		if (!result.ok) {
			throw new Error(`HTTP error! status: ${result.status}`);
		}

		const resultData = await result.json();
		console.log(resultData);
	} catch (e) {
		console.error("error upserting: ", e);
	}
};

// EXAMPLE USAGE
// const main = async () => {
//   const thing: MatterArticle = {
//     id: "41906466",
//     title: "The Modern Wisdom Of Daoist History",
//     author: "Dingxin Zhao",
//     publisher: "Noema",
//     url: "https://www.noemamag.com/the-modern-wisdom-of-daoist-history",
//     tags: "",
//     wordCount: 2486,
//     inQueue: true,
//     favorited: false,
//     read: false,
//     highlightCount: 0,
//     lastInteractionDate: "2023-11-17 17:54:18",
//   };

//   const thingVector: Vector = {
//     id: thing.id,
//     values: [
//       0.05316162, -0.0038986206, 0.017028809, -0.022079468, -0.0001757145,
//       -0.007194519, 0.040283203, -0.0027103424, -0.014656067, 0.034179688,
//       -0.010627747, 0.046722412, -0.03366089, -0.003955841, -0.013458252,
//       0.0029258728, 0.03164673, 0.00497818, 0.012107849, -0.011138916,
//       -0.015296936, 0.0022296906, 0.016540527, -0.004600525, 0.045776367,
//       -0.0143966675, -0.02909851, 0.011497498, 0.015258789, 0.01612854,
//       0.018753052, -0.016525269, 0.009941101, 0.026168823, -0.046051025,
//       -0.025161743, 0.0058174133, -0.008979797, -0.0088272095, 0.03768921,
//       -0.012763977, 0.016311646, -0.054595947, -0.022476196, -0.09277344,
//       0.0012626648, -0.03640747, 0.03704834, -0.00749588, 0.003227234,
//       -0.006275177, -0.0112838745, 0.0013809204, -0.07513428, -0.016326904,
//       -0.027770996, -0.0132751465, -0.012710571, 0.0135650635, 0.041625977,
//       -0.020706177, 0.010215759, 0.012535095, -0.03149414, 0.0011949539,
//       0.00037145615, 0.06506348, 0.01876831, 0.023269653, -0.02961731,
//       -0.018997192, 0.030395508, 0.0025978088, -0.06112671, -0.0093307495,
//       0.02708435, -0.0033664703, -0.013435364, -0.0006246567, -0.03765869,
//       -0.021362305, -0.007926941, 0.0056915283, -0.05847168, 0.02027893,
//       -0.02848816, -0.005340576, 0.0016727448, -0.026290894, 0.008628845,
//       -0.019470215, -0.040863037, -0.015151978, 0.00096940994, 0.009017944,
//       -0.032409668, 0.021209717, -0.010139465, -0.009414673, -0.035125732,
//       -0.019454956, 0.0026988983, -0.061401367, -0.0035972595, -0.015541077,
//       0.04788208, 0.012062073, 0.024093628, -0.00749588, -0.0042686462,
//       0.0028438568, -0.013458252, -0.0021839142, -0.043823242, 0.029220581,
//       0.038848877, -0.0028152466, 0.041412354, 0.011299133, -0.0023593903,
//       -0.034179688, -0.022369385, 0.042022705, 0.02204895, -0.019439697,
//       -0.040496826, -0.010932922, -0.024963379, 0.076171875, -0.000030219555,
//       0.018478394, 0.012634277, -0.03982544, -0.015350342, -0.020828247,
//       0.0032615662, 0.011192322, -0.029693604, -0.0016078949, -0.009384155,
//       0.10296631, -0.011398315, 0.0054512024, 0.06903076, 0.020904541,
//       -0.0128479, 0.01084137, 0.009101868, 0.01713562, 0.05480957, -0.052612305,
//       0.050231934, 0.0048980713, -0.010375977, -0.023483276, 0.0075149536,
//       -0.091552734, 0.021621704, 0.04751587, 0.039764404, -0.008430481,
//       0.019760132, 0.039154053, 0.07861328, 0.023208618, 0.00415802,
//       0.024505615, 0.021469116, 0.011138916, -0.00365448, -0.014472961,
//       -0.021865845, 0.0014238358, -0.00920105, -0.01663208, 0.021896362,
//       0.01473999, -0.056488037, 0.025222778, 0.05291748, 0.007850647,
//       -0.024291992, -0.024139404, 0.0107040405, -0.048461914, 0.00932312,
//       -0.015098572, 0.014595032, 0.050476074, 0.013465881, 0.017166138,
//       -0.005794525, -0.023849487, -0.006000519, -0.0011892319, 0.0128479,
//       0.03439331, 0.0418396, 0.021408081, -0.051879883, 0.00868988, 0.061462402,
//       -0.053894043, -0.01828003, -0.121398926, 0.026229858, -0.0345459,
//       0.04751587, 0.019195557, 0.0020389557, 0.0007452965, -0.023651123,
//       -0.009124756, -0.0010080338, -0.021118164, -0.03048706, -0.029891968,
//       -0.0063476562, -0.014137268, 0.020050049, -0.02708435, 0.011886597,
//       -0.059051514, -0.04547119, 0.021865845, 0.023025513, 0.002380371,
//       0.007534027, 0.045898438, 0.048187256, -0.0014390945, -0.033447266,
//       -0.027740479, -0.028198242, -0.068481445, -0.019515991, -0.051940918,
//       -0.0015115738, 0.0053100586, 0.045928955, 0.025390625, -0.0395813,
//       -0.014976501, 0.009162903, -0.07299805, -0.091796875, 0.010887146,
//       -0.030593872, -0.03189087, -0.025527954, 0.0574646, 0.008842468,
//       0.029907227, 0.014518738, -0.0050201416, 0.038909912, 0.042633057,
//       0.0075950623, -0.032989502, 0.0023345947, 0.016433716, 0.035186768,
//       -0.06567383, 0.036621094, -0.013389587, -0.037902832, 0.009597778,
//       -0.012832642, -0.018127441, -0.02268982, 0.03488159, 0.008056641,
//       -0.022033691, -0.03137207, -0.018478394, -0.047058105, -0.029724121,
//       0.049194336, -0.013366699, -0.047576904, -0.015823364, -0.04788208,
//       0.026763916, 0.00040721893, -0.0003836155, -0.043670654, 0.071777344,
//       0.024261475, 0.052886963, 0.0062294006, 0.021652222, 0.02986145,
//       4.172325e-7, 0.041168213, 0.013755798, -0.044891357, -0.10369873,
//       0.018188477, 0.0077438354, -0.013389587, -0.014877319, 0.0592041,
//       0.029922485, 0.016906738, -0.0022792816, -0.0066566467, 0.016418457,
//       -0.034362793, -0.047180176, -0.03604126, -0.016098022, 0.006664276,
//       -0.018585205, 0.01084137, -0.022659302, 0.0010404587, 0.012878418,
//       -0.020889282, 0.06311035, 0.09033203, 0.042877197, 0.008476257,
//       -0.05847168, -0.016616821, -0.01864624, -0.010391235, -0.024398804,
//       -0.019241333, 0.0143966675, -0.0011396408, 0.0053138733, -0.023422241,
//       -0.040863037, -0.026901245, 0.0039901733, -0.0016059875, 0.008468628,
//       -0.031311035, -0.014572144, 0.018310547, 0.00027275085, 0.007980347,
//       0.01576233, -0.046661377, 0.07183838, -0.00070238113, -0.014205933,
//       0.021636963, 0.029891968, 0.046417236, -0.080078125, -0.02911377,
//       0.006095886, 0.035064697, 0.029510498, 0.0027484894, 0.005344391,
//       0.017562866, 0.006855011, -0.030136108, -0.03062439, 0.014160156,
//       -0.026901245, 0.0053749084, 0.002450943, -0.02897644, 0.026687622,
//       0.003528595, 0.021453857, 0.06915283, -0.055877686, 0.032806396,
//       -0.05734253, 0.0012769699, 0.018875122, 0.020324707, 0.09802246,
//       -0.014282227, 0.009849548, 0.060150146, 0.0005302429, 0.03652954,
//       -0.07696533, -0.0015029907, 0.055541992, -0.007888794, -0.049194336,
//       -0.029830933, 0.04815674, 0.03665161, 0.011428833, -0.039733887,
//       -0.031402588, -0.028274536, 0.0340271, 0.0014019012, 0.060577393,
//       0.05279541, -0.02998352, -0.05255127, -0.053466797, -0.00022673607,
//       -0.008026123, -0.027923584, 0.009300232, -0.021133423, -0.012107849,
//       -0.034698486, 0.048583984, -0.04196167, 0.0096588135, 0.03378296,
//       0.011360168, -0.00096797943, -0.041809082, -0.024108887, -0.017440796,
//       0.0047035217, 0.011955261, -0.014419556, 0.0067710876, -0.0032024384,
//       0.016738892, 0.029022217, -0.005088806, 0.015396118, 0.014152527,
//       0.01576233, -0.004180908, -0.009811401, 0.0027866364, -0.037078857,
//       0.01171875, -0.0061149597, -0.0848999, -0.019577026, -0.0236969,
//       0.03515625, 0.024337769, -0.038909912, -0.07940674, -0.029953003,
//       0.049591064, 0.013114929, 0.0067749023, 0.024932861, -0.008483887,
//       -0.027572632, 0.018814087, 0.03036499, -0.013061523, 0.009986877,
//       -0.0029277802, 0.017074585, -0.022033691, -0.020507812, 0.019073486,
//       0.026138306, -0.052337646, 0.043395996, 0.05038452, 0.011222839,
//       -0.0005121231, -0.015640259, 0.0056991577, 0.037322998, 0.023666382,
//       -0.011383057, 0.0012397766, 0.002456665, -0.0038261414, -0.021987915,
//       -0.005290985, 0.0060691833, -0.007949829, 0.036224365, 0.0046844482,
//       -0.0067825317, 0.019485474, 0.017578125, -0.04220581, 0.018203735,
//       -0.018005371, 0.008674622, -0.005420685, 0.024734497, 0.012840271,
//       -0.00579834, -0.02583313, -0.026779175, 0.037109375, -0.010406494,
//       0.012519836, 0.00034451485, -0.026275635, -0.050231934, -0.029205322,
//       0.10357666, 0.009300232, -0.026184082, 0.040039062, -0.019989014,
//       -0.013931274, 0.022277832, -0.027709961, 0.019866943, 0.044189453,
//       -0.022460938, 0.0049095154, -0.043395996, 0.03451538, -0.041381836,
//       0.0463562, -0.021728516, 0.0039520264, -0.03540039, 0.03289795,
//       -0.02961731, -0.013389587, 0.0061035156, -0.00038218498, -0.040740967,
//       0.07501221, 0.017791748, -0.05178833, 0.0104904175, 0.0769043,
//       0.006095886, -0.026916504, 0.0012197495, -0.01008606, 0.0028762817,
//       -0.049957275, -0.038513184, 0.056030273, 0.006198883, 0.0029792786,
//       -0.062561035, -0.051086426, 0.031097412, 0.033325195, 0.008377075,
//       -0.00868988, 0.022369385, 0.027633667, -0.029312134, 0.04220581,
//       0.014945984, -0.03463745, 0.013183594, -0.015914917, 0.012329102,
//       -0.0982666, 0.00090932846, -0.011581421, 0.017745972, -0.07989502,
//       0.044677734, -0.02508545, -0.013931274, 0.0036563873, 0.010177612,
//       0.0009832382, -0.0020542145, 0.035369873, 0.023925781, -0.021362305,
//       -0.029373169, 0.0053634644, -0.03930664, -0.06317139, -0.023132324,
//       0.019241333, 0.01876831, 0.026504517, -0.0026378632, 0.03933716,
//       0.032806396, -0.010444641, -0.050567627, -0.02267456, 0.0063934326,
//       0.04321289, 0.07324219, 0.013153076, 0.052368164, -0.02204895,
//       0.0029716492, 0.021865845, 0.040924072, 0.013298035, -0.029541016,
//       0.005355835, -0.007003784, -0.0073928833, -0.010673523, -0.011001587,
//       -0.032989502, -0.007507324, -0.018096924, 0.031402588, 0.018188477,
//       0.008125305, -0.006175995, -0.041290283, 0.0023422241, -0.000521183,
//       0.009613037, 0.029785156, 0.027267456, -0.0209198, -0.044891357,
//       0.03363037, 0.024154663, 0.022033691, -0.031173706, -0.04107666,
//       0.009994507, 0.010437012, 0.018707275, -0.0014152527, -0.0064888,
//       0.0146865845, -0.03640747, 0.043884277, -0.075683594, -0.011352539,
//       -0.01751709, 0.008117676, 0.019744873, -0.033569336, 0.019958496,
//       -0.02142334, -0.04837036, 0.040405273, 0.04385376, -0.019973755,
//       0.016021729, -0.030303955, 0.004272461, 0.020355225, 0.013160706,
//       0.05545044, -0.0146102905, 0.017211914, -0.011070251, 0.0038700104,
//       0.019592285, -0.014297485, 0.035308838, 0.03781128, -0.00082588196,
//       -0.07574463, 0.0047836304, 0.0184021, 0.0013933182, -0.0069732666,
//       0.015159607, -0.014709473, -0.0093688965, 0.013999939, 0.049987793,
//       -0.021453857, 0.027160645, 0.028793335, 0.028625488, 0.017333984,
//       0.014549255, 0.004722595, 0.04421997, -0.021224976, 0.023788452,
//       0.0034275055, 0.008972168, 0.02331543, -0.008453369, 0.034454346,
//       0.013191223, -0.0076446533, -0.00073194504, 0.006275177, -0.04208374,
//       -0.013313293, 0.007621765, -0.042266846, 0.006416321, -0.04751587,
//       0.014015198, 0.058685303, 0.05569458, -0.013160706, -0.030654907,
//       0.072753906, -0.025268555, -0.022323608, 0.08001709, -0.019180298,
//       -0.04699707, 0.032196045, -0.027816772, 0.01953125, -0.025421143,
//       -0.021636963, -0.05255127, -0.008857727, 0.048583984, -0.045959473,
//       -0.008850098, -0.0390625, 0.009292603, -0.029632568, -0.01209259,
//       -0.004425049, -0.016815186, 0.034179688, -0.006198883, 0.03463745,
//       0.031234741, 0.0071105957, -0.009902954, -0.041748047, -0.009109497,
//       -0.023880005, -0.023086548, 0.0035896301, -0.034332275, -0.04940796,
//       -0.012542725, -0.04220581, -0.0635376, -0.014175415, 0.029708862,
//       -0.033966064, 0.0041999817, 0.0039520264, 0.0005464554, 0.02748108,
//       -0.049621582, -0.039764404, -0.03277588, 0.021148682, -0.002500534,
//       0.010429382, -0.020523071, -0.0012321472, -0.005680084, 0.0029735565,
//       0.021942139, 0.015701294, -0.025909424, 0.056793213, 0.00856781,
//       -0.06524658, -0.0016994476, 0.016342163, -0.021133423, -0.074523926,
//       0.050750732, -0.026611328, 0.024856567, -0.043548584, 0.0024909973,
//       -0.0135650635, -0.011154175, -0.010681152, -0.04425049, 0.08538818,
//       0.07556152, 0.053863525, -0.019927979, -0.033050537, -0.030334473,
//       0.019180298, 0.070617676, 0.031188965, 0.020568848, -0.00724411,
//       0.031707764, -0.005680084, 0.007820129, -0.0062065125, 0.01436615,
//       0.011169434, -0.008308411, 0.038879395, -0.0028133392, 0.021621704,
//       -0.029067993, -0.015960693, -0.012908936, -0.0039596558, 0.0357666,
//       0.0025959015, 0.04458618, 0.040374756, 0.043945312, 0.0046577454,
//       -0.001045227, -0.023803711, -0.035583496, 0.0025043488, -0.027236938,
//       -0.047454834, -0.06512451, -0.026351929, -0.032562256, 0.014526367,
//       -0.018569946, -0.023803711, -0.008621216, -0.00067281723, -0.018447876,
//       0.04425049, -0.003534317, -0.026992798, -0.0107803345, 0.038909912,
//       -0.001964569, -0.018539429, 0.045928955, -0.033843994, 0.0053215027,
//       0.03302002, 0.0076179504, -0.00920105, 0.045776367, -0.02142334,
//       -0.050201416, 0.024902344, 0.024963379, 0.035003662, 0.04244995,
//       -0.0077171326, 0.033233643, -0.010620117, -0.047973633, -0.017486572,
//       0.033935547, 0.05279541, -0.0010223389, 0.046417236, -0.040924072,
//       0.009719849, 0.007408142, -0.0034503937, -0.061431885, -0.012481689,
//       -0.0011930466, -0.0042877197, -0.017562866, 0.020446777, -0.024597168,
//       -0.026123047, 0.008987427, 0.008995056, 0.018127441, -0.036376953,
//       -0.04840088, -0.0524292, 0.014862061, 0.038513184, -0.047302246,
//       -0.07324219, -0.009979248, -0.013664246, -0.0044021606, -0.008918762,
//       -0.0463562, 0.011245728, -0.054595947, 0.019424438, 0.037139893,
//       -0.016998291, 0.013465881, -0.020324707, 0.018814087, -0.007949829,
//       0.032073975, -0.013786316, -0.014129639, 0.013122559, -0.03048706,
//       0.02494812, -0.0037937164, -0.03845215, -0.03567505, -0.013549805,
//       0.010513306, -0.025131226, -0.008605957, -0.02619934, -0.008079529,
//       0.018798828, -0.009147644, 0.031585693, 0.03579712, 0.0022087097,
//       -0.014122009, 0.009460449, -0.05303955, 0.026870728, 0.032684326,
//       0.022155762, -0.0050315857, -0.027664185, -0.006668091, -0.014427185,
//       0.0013465881, -0.024154663, -0.014221191, 0.019073486, 0.015281677,
//       0.013633728, -0.006958008, 0.0069084167, -0.029327393, 0.00856781,
//       0.02168274, 0.059814453, 0.060150146, 0.02003479, 0.025970459,
//       0.007133484, -0.037597656, -0.04220581, -0.011894226, 0.050354004,
//       -0.00006210804, -0.021438599, 0.018966675, 0.020263672, 0.020935059,
//       0.08996582, -0.036376953, 0.0524292, 0.011528015, -0.011917114,
//       0.028869629, -0.009521484, 0.0073394775, 0.016708374, -0.024734497,
//       0.0024681091, 0.0009598732, -0.00012946129, 0.030288696, 0.021087646,
//       0.0048446655, -0.038879395, -0.032043457, -0.040740967, 0.015319824,
//       0.00178051, -0.055389404, 0.0579834, -0.02432251, -0.064697266,
//       0.049835205, 0.047302246, 0.08996582, -0.022918701, 0.007865906,
//       0.0033168793, 0.022598267, 0.010345459, 0.04220581, -0.00015842915,
//       -0.0357666, 0.025619507, 0.01751709, 0.0030841827, -0.0044441223,
//       -0.016281128, 0.026794434, 0.002292633, -0.042266846, -0.007926941,
//       0.015853882, -0.016494751, -0.023895264, 0.009185791, -0.0002309084,
//       -0.013366699, -0.02935791, -0.015098572, -0.0115737915, 0.009674072,
//       0.023162842, 0.006385803, 0.0017232895, 0.021408081, 0.09265137,
//       -0.017791748, -0.035980225, 0.026992798, 0.026046753, 0.0067825317,
//       -0.0017366409, 0.008087158, -0.008140564, 0.0066452026, -0.0158844,
//       0.0043945312, -0.05505371, 0.026046753, -0.043548584, -0.03466797,
//       -0.026611328, -0.05709839, -0.0637207, -0.017120361, -0.006095886,
//       -0.018218994, 0.030914307, 0.0024414062, 0.009933472, 0.0020103455,
//       -0.0068855286, 0.041748047, -0.04058838, 0.0074501038, 0.012992859,
//       0.02507019, 0.031097412,
//     ],
//     metadata: thing,
//   };

//   upsertToPinecone([thingVector]);
// };
